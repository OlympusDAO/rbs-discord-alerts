query RBSPriceEvents($latestBlock: BigInt!) {
  priceEvents(orderBy: block, orderDirection: asc, where: { block_gt: $latestBlock }) {
    id
    blockchain
    block
    transaction
    date
    type
    isHigh
    timestamp
    capacityOhm
    price
    priceMovingAverage
    cushionHighPrice
    cushionLowPrice
    wallHighPrice
    wallLowPrice
  }
}

fragment RangeSnapshotParts on RangeSnapshot {
  id
  blockchain
  block
  date
  timestamp
  ohmPrice
  ohmMovingAveragePrice
  cushionHighPrice
  cushionHighCapacityOhm
  wallHighPrice
  cushionLowPrice
  cushionLowCapacityOhm
  wallLowPrice
}

query LatestRangeSnapshot {
  rangeSnapshots(orderBy: block, orderDirection: desc, first: 1) {
    ...RangeSnapshotParts
  }
}

query LowerCushionCapacityDepleted($sinceDate: String!, $belowCapacity: BigDecimal!) {
  rangeSnapshots(
    orderBy: block
    orderDirection: desc
    where: { date_gt: $sinceDate, cushionLowCapacityOhm_lt: $belowCapacity }
  ) {
    ...RangeSnapshotParts
  }
}

query UpperCushionCapacityDepleted($sinceDate: String!, $belowCapacity: BigDecimal!) {
  rangeSnapshots(
    orderBy: block
    orderDirection: desc
    where: { date_gt: $sinceDate, cushionHighCapacityOhm_lt: $belowCapacity }
  ) {
    ...RangeSnapshotParts
  }
}

query LowerWallBroken($sinceDate: String!, $belowPrice: BigDecimal!) {
  rangeSnapshots(orderBy: block, orderDirection: desc, where: { date_gt: $sinceDate, ohmPrice_lt: $belowPrice }) {
    ...RangeSnapshotParts
  }
}
