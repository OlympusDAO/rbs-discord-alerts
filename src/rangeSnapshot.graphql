query RBSPriceEvents($latestBlock: BigInt!) {
  priceEvents(orderBy: block, orderDirection: asc, where: { block_gt: $latestBlock }) {
    id
    blockchain
    block
    transaction
    date
    type
    isHigh
    timestamp
    capacityOhm
    price
    priceMovingAverage
    cushionHighPrice
    cushionLowPrice
    wallHighPrice
    wallLowPrice
  }
}

# Something with the pulumi build process causes GraphQL fragments to generate an error, so the fields are repeated here
query LatestRangeSnapshot {
  rangeSnapshots(orderBy: block, orderDirection: desc, first: 1) {
    id
    blockchain
    block
    date
    timestamp
    ohmPrice
    ohmMovingAveragePrice
    cushionHighPrice
    cushionHighCapacityOhm
    wallHighPrice
    cushionLowPrice
    cushionLowCapacityOhm
    wallLowPrice
  }
}

query LowerCushionCapacityDepleted($sinceDate: String!, $belowCapacity: BigDecimal!) {
  rangeSnapshots(
    orderBy: block
    orderDirection: desc
    where: { date_gt: $sinceDate, cushionLowCapacityOhm_lt: $belowCapacity }
  ) {
    id
    blockchain
    block
    date
    timestamp
    ohmPrice
    ohmMovingAveragePrice
    cushionHighPrice
    cushionHighCapacityOhm
    wallHighPrice
    cushionLowPrice
    cushionLowCapacityOhm
    wallLowPrice
  }
}

query UpperCushionCapacityDepleted($sinceDate: String!, $belowCapacity: BigDecimal!) {
  rangeSnapshots(
    orderBy: block
    orderDirection: desc
    where: { date_gt: $sinceDate, cushionHighCapacityOhm_lt: $belowCapacity }
  ) {
    id
    blockchain
    block
    date
    timestamp
    ohmPrice
    ohmMovingAveragePrice
    cushionHighPrice
    cushionHighCapacityOhm
    wallHighPrice
    cushionLowPrice
    cushionLowCapacityOhm
    wallLowPrice
  }
}

query RangeSnapshot($block: BigInt!) {
  rangeSnapshots(orderBy: block, orderDirection: desc, where: { block: $block }) {
    id
    blockchain
    block
    date
    timestamp
    ohmPrice
    ohmMovingAveragePrice
    cushionHighPrice
    cushionHighCapacityOhm
    wallHighPrice
    cushionLowPrice
    cushionLowCapacityOhm
    wallLowPrice
  }
}
